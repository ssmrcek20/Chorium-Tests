using Emgu.CV;
using Emgu.CV.Face;
using Emgu.CV.Structure;
using FakeItEasy;
using SlojEntiteta.Entiteti;
using SlojPoslovneLogike.Servisi;
using SlojUpravljanjaSBazomPodataka.repozitoriji;
using SlojUpravljanjaSBazomPodataka.Sucelja;
using System;
using System.Collections.Generic;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xunit;

namespace JedinicnoTestiranje
{
    public class KorisnikServis_Tests
    {
        [Fact]
        public void RegistrirajKorisnika_GivenKorisnikPostoji_ReturnsFlase()
        {
            Korisnik korisnik = new Korisnik
            {
                Ime = "test",
                Prezime = "test",
                Email = "test.test@gmail.com",
                Korisnicko_ime = "test",
                Lozinka = "test",
                ID_tip_korisnika = 1,
                Datum_rodenja = new DateTime(1990, 1, 1)
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.ProvjeriKorisnikoIme(korisnik.Korisnicko_ime)).Returns(true);
            A.CallTo(() => fakeRepo.Dodaj(korisnik)).Returns(0);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool korisnikRegistriran = korisnikServis.RegistrirajKorisnika(korisnik);

            Assert.False(korisnikRegistriran);
        }

        [Fact]
        public void RegistrirajKorisnika_GivenKorisnikNePostoji_ReturnsTrue()
        {
            Korisnik korisnik = new Korisnik
            {
                Ime = "test",
                Prezime = "test",
                Email = "test.test@gmail.com",
                Korisnicko_ime = "test",
                Lozinka = "test",
                ID_tip_korisnika = 1,
                Datum_rodenja = new DateTime(1990, 1, 1)
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.ProvjeriKorisnikoIme(korisnik.Korisnicko_ime)).Returns(false);
            A.CallTo(() => fakeRepo.Dodaj(korisnik)).Returns(1);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool korisnikRegistriran = korisnikServis.RegistrirajKorisnika(korisnik);

            Assert.True(korisnikRegistriran);
        }

        [Fact]
        public void DohvatiTrenutnogKorisnika_GivenKorisnikIsNotLoggedIn_ReturnsNull()
        {
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            Korisnik korisnik = korisnikServis.DohvatiTrenutnogKorisnika();

            Assert.Null(korisnik);
        }
        [Fact]
        public void DohvatiTrenutnogKorisnika_GivenKorisnikIsLoggedIn_ReturnsKorisnikObject()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka"
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.DohvatiKorisnika(korisnik.Korisnicko_ime)).Returns(korisnik);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            korisnikServis.ProvjeriIspravnostPodataka(korisnik.Korisnicko_ime, korisnik.Lozinka);

            var prijavljeniKorisnik = korisnikServis.DohvatiTrenutnogKorisnika();

            Assert.Equal(korisnik.ID, prijavljeniKorisnik.ID);
        }

        [Fact]
        public void ProvjeriIspravnostPodataka_GivenValidCredentials_ReturnsTrue()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka"
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.DohvatiKorisnika(korisnik.Korisnicko_ime)).Returns(korisnik);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool provjera = korisnikServis.ProvjeriIspravnostPodataka(korisnik.Korisnicko_ime, korisnik.Lozinka);

            Assert.True(provjera);
        }

        [Fact]
        public void ProvjeriIspravnostPodataka_GivenInvalidCredentials_ReturnsFalse()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "krivalozinka"
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.DohvatiKorisnika(korisnik.Korisnicko_ime)).Returns(null);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool provjera = korisnikServis.ProvjeriIspravnostPodataka(korisnik.Korisnicko_ime, korisnik.Lozinka);

            Assert.False(provjera);
        }

        [Fact]
        public void ProvjeriKorisnika_GivenUserIsParent_ReturnsTrue()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 1
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.DohvatiKorisnika(korisnik.Korisnicko_ime)).Returns(korisnik);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            korisnikServis.ProvjeriIspravnostPodataka(korisnik.Korisnicko_ime, korisnik.Lozinka);

            bool provjera = korisnikServis.ProvjeriKorisnika();

            Assert.True(provjera);
        }

        [Fact]
        public void ProvjeriKorisnika_GivenUserIsNotParent_ReturnsFalse()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            A.CallTo(() => fakeRepo.DohvatiKorisnika(korisnik.Korisnicko_ime)).Returns(korisnik);
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            korisnikServis.ProvjeriIspravnostPodataka(korisnik.Korisnicko_ime, korisnik.Lozinka);

            bool provjera = korisnikServis.ProvjeriKorisnika();

            Assert.False(provjera);
        }

        [Fact]
        public void ProvjeriDobneGranice_GivenUsersMeetTheRequirements_ReturnsTrue()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000")
            };
            Kategorija kategorija = new Kategorija
            {
                Dobna_granica = 5
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool provjera = korisnikServis.ProvjeriDobneGranice(new List<Korisnik> { korisnik}, kategorija);

            Assert.True(provjera);
        }

        [Fact]
        public void ProvjeriDobneGranice_GivenUsersDontMeetTheRequirements_ReturnsFalse()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000")
            };
            Korisnik korisnik2 = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "asaaa",
                Lozinka = "dsfdssdfdfs",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2020-08-03 00:00:00.000")
            };
            Kategorija kategorija = new Kategorija
            {
                Dobna_granica = 5
            };
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            bool provjera = korisnikServis.ProvjeriDobneGranice(new List<Korisnik> { korisnik, korisnik2 }, kategorija);

            Assert.False(provjera);
        }

        [Fact]
        public void SkenirajLice_GivenDirectorySlikeDontExists_FilesLenghtIsOne()
        {
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            string putanja = Directory.GetCurrentDirectory() + @"\slike";
            Directory.CreateDirectory(putanja);
            Directory.Delete(putanja, true);

            korisnikServis.SkenirajLice();
            string[] files = Directory.GetFiles(putanja, "*.jpg", SearchOption.AllDirectories);

            Assert.Single(files);
        }
        [Fact]
        public void SkenirajLice_GivenDirectorySlikeExists_FilesLenghtIsOne()
        {
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            string putanja = Directory.GetCurrentDirectory() + @"\slike";
            Directory.CreateDirectory(putanja);

            korisnikServis.SkenirajLice();
            string[] files = Directory.GetFiles(putanja, "*.jpg", SearchOption.AllDirectories);

            Assert.Single(files);
        }

        [Fact]
        public void StvoriFaceRecognizer_GivenNoImages_ReturnsNULL()
        {
            var slike = new List<Image<Gray, byte>>();
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);

            var eigenFaceRecognizer = korisnikServis.StvoriFaceRecognizer(slike);

            Assert.Null(eigenFaceRecognizer);
        }

        [Fact]
        public void StvoriFaceRecognizer_GivenImages_ReturnsEigenFaceRecognizer()
        {
            var slike = new List<Image<Gray, byte>>();
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            int width = 200;
            int height = 200;
            Bitmap bitmap = new Bitmap(width, height);
            Image<Gray, Byte> emguImage = new Image<Gray, Byte>(bitmap);
            slike.Add(emguImage);
            var eigenFaceRecognizer = korisnikServis.StvoriFaceRecognizer(slike);
            Assert.True(eigenFaceRecognizer.GetType() == new EigenFaceRecognizer().GetType());

        }

        [Fact]
        public void popuniPopisSlika_GivenUsers_ReturnsImages()
        {
            string varbinaryValue = "0xFFD8FFE000104A46494600010101006000600000FFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC000110800C800C803012200021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00F47F29339DDF29E6A278E21C0279EE6A48C6F3B71F4A8091F6AF218F7C1A00A5770001810A40E86B97D4BCBCED0C0B679C5745AF38B488C65FDB35C59677999987CB9EB40156657270071EB508B756FBC49F6AD26DA47F4A238373702802945A7ACCF855AD48345F2D77EDE715B1A7D8858C6E1FA55F9633B70A3AD0072735B1048C74EB55DA2C0C015BD750EC90F7CD6749181D680326E22063C8EB59A53E6C77ADE95148C0ACCB987072050036DE523E53F855E95CFD991C74DD835938231EB9AD68713D998D8F5FD0D005275C72BD3BD2891D4E55CAB0FBAC29A3219A36EA3834F31ED1CFE06803774EF1212820BD40C98C17CF22B55E25961DAB379D6EC38CF38AE2997E607D6A7B3D425B597CA676D84E460E280361EC64B39F2013113F787415A30B65432394993A63BD3209DAFA0FF47915D80E509C6E14E589678C94CA4C9D8F51ED401AB61AE6D6D9326DF5DB5A7F6C8251F2BF5EC6B8D91D83EE030E3EF0F5AB51CE268F23861401D1ADCAC728527E53D0FA55DAE4A0BD25B6B9C83FA1AE9AD25F36DD5BAF14013F5A297B5140104B3385658CFCEBC8AAD7174240B36E1B94723D4553D55CC13C72E4ED248201C66B166D44A4A62DE1D33919EA2800D76F4DC36EDF8C8E73DEB9F13B16FBDF2F6ABDAA90D1824800F2083D6B260F99F1D68034EDC34AE1477EF5D059D98E38E9EB59FA3DA99240D8E3B575904223EA381400914185C63A54C20F94B11C7AD4C839E94E921F317693F2FA50073F7815FEEF3E86B2E58720E475AEA26B48D3B74AC9B955F98628039D9936E6B3A6C9E0F7ADBB98C7359EF06EFA500643260D4D14FE5A11EF53C96E3A8155A4888068026BA40EAB3C7D48E47AD4292865C139F4A742E443E593DF22A2923E7728C1CE68027D8248CE3A8E98A8DE0F363C7F1AF4A75B4849C8E08EA2A752AC4E3834014E0B996D9F7A92194FCC01AE9ED75486FD55D9B64E3F8D7827D88EF5CF4F1873BC75EF552166B56720F7E2803B5B8B759C192375320EBB4F5ACB676B7977FDDFEF0A8ACB50F323576E1C704FAD4D3B0989EDBA801E261E76E53C38AEB34197CCB5653FC26B8685F9DB9CE0D76BE1A19B690FA91401B78A29FB78A28032B5DB25B8D3A47E77C4A5D71ED5E75E7F99719E8075E6BD56EC2B5ACC1BA1420FE55E35732B40E5571807F3A00B33B7EF58090B293C82781572C1109000E4F53582B33CB265B807AD6EE94DBE55C76A00ECB4A802C608AD94538ACED394EC515BF0C41532C00CFAD00575F947350CD73B5480453AEEE238C1C30AC1BCBE40080D40125D5EBE719CFE359B25C93F7AA092E831EB54669F9E0D004B34F96355CC9EB5017FCE9A58F7A0091DF70C2D576048E99A93B668C7A50057F2B3CD1E493D6AD04029C17268033FECEC1F720EF4EF9BB0E7BD5F117A50F0E5738E68033BCE03208E6A3980DBC0E0D599E03DC0FA8AAAC840228022B7678D4824D68DBCC5E1009C91EB59392B9209ABB6EF84C9FCA80268E63F6C29FC22BD07C2F206B69547620D79C0C34BB81E7AD77DE1105A167073C007EB401D5638A28C7145004372BBA0947AA1FE55E17752E6E9949E84D7BD3AEE4C1EF5E0DA9C5E4DFDCC78E92B0FD68022F3016C0CE2B7B433BA7503D6B992FCFA574DE1A52D286C74EB401E8F68EB6D6E1DF83D8566EA3E25218A2B7E00D66EA5AA30FDD29EDCFB573922191892E79A00BB7BAFC85CFEF2B224D65D9B2CE71492C309FBCD9AA525BC45B826802F47AA166EBC558FB5891722B185BAAB02AD9F519AB51211D7F4A00D157CD3F3C641AAC84807353A007AD003C36474A7834C039C74A93690322801F9C73DA955D7B91552477008159F3DCC887AD006E19D1475151FDA50F7AE79EE9D8724D3A3989E39A00E8498DD7AF5A6BDB7C9F2D66C3232F24E6B6ED2E03AAAB28C50073B7319858E4700F4A87CD60C0D6B6B51A44E1BF84F7ACA1192DC0A00B714664E87AD7A5F84AD05BE981C1C973935E6D6A0F9AA2BD63401FF0012C8B8ED401A7839A29D8A280187A67D2BC3FC430B0D5EF1802374AC40FC6BD89750836FCCFCD799F8DD634D61DE0198E450C71D8F43401C94713135DDF862C82D8991BA93C66B93B68790C7A57A16910795A4C5DB23340183A97CB72FE84D63CD2B336C4EB5B7AB21DEC45627CE99D88493DE802192111A92F2553778F181266B5BEC425B7639DD215E335CD5C5BC919E878EA2802D107AA367E953DBDC32B6D63F9D55B65C9CF6039A7161E663AF3D68037A19038AB90C7BFA0AC8B20DD2BA5B2114509694F3D863AD0041F6639CF4A98C384CE2AEA2ACABBD4706A66B62D0B6076A00E6EE5E38C126B0EE6E03B10AA2AF6A4584CCA7802A86C1B4B81D2802240CDD6AE40190F0A3F2ACE6B8649001D4D69E9CF34ACE00DC40C9CD005E81D4B00E9835A30C409CAD52F9268F85DB22F6AB764C5800DC50051D7D192DC16F5C8AC7B498F4CD74BE268BFE25B1B63A1C1AE56CF25F1401B9000D3C781EF5EB1A34463D3E256EE322BCAF4D5F32F631DBA57AB5BDE5BC7046833F2A81D2802FE28AABFDA10FBD1401E53637F7979790C0B72C1A460B927815D07893C30B0E99F6B8EF4DC4A832C028C11ED5C67879DDF5BB503FBC4FE95D67DBE758A642774633C7A5007216C0CB2A22E719AF4D820DBA7C283B20AE1B4FB657BC509D0B57A2C6A02AA7A0C500615CE97E7724550B9D3E2B78F85E71C9AEC8C036D51B8D352E0618E3E9401E7937C849562B59375089242CC793D6BBEBDF0F5B2E4EE7CFFBDC561DCE990AB6157E9401CAF97B461054D6F66CEDF77AD6FC7A6AE791D2AEDBD92A9181401574ED3B91915D45B69914C1448BF28E98A8EC605561C57456908D80E28029496114312AA2600151343881B1E95AB798C62AAB2836FD3F1A00E075EB12252E0704573CAA41656E86BD0EF6D84AA548AE66EB482AFF0020E28039F5B53E67DD0C074AE8AC45BDBC390332BFDEFF000AAD1D8C8ADC0CFB568456B22F2633F5C50040F6CCEFBD063D2AED95BB6F19ABF696F9C657B7A5684767B5B38A00C7F1143BB46638FBA457176ABB5C9AF46D6E1CE8F38FF67FAD7051C7B1980F5A00DDD02DFCEBF524700E4D76BE4438FF00562B17C2D345A64325C48A0B380141AE80CE2EC79A11537761401179308E762D1526DA2803CF740B5103CF7A400B1A10A7DCD6D3404787E49FF8A43919F4AAB05932D9B4311259DC55BD72F9515AD23E238D020028033B4200DEC6BEF9AEE226E735C4E8B1BADC452918562403EB5D609085A00D1370318E2A94F78470B55249CE707AD4449618F5A006DCCCD20C13548C191B8F19AD108ABC919AAB72DC7068029B00BD29D1F032DCFD2A09A7C1E452D987BCB948A3E4B1FCA8037B4D85E761B47CBDCD75505B055158E2E20D321112E3E51C9AAF37888AA908DF36280346F593CC2991D69CB007B6F94D71F2EA72348496AD6D335765C239CAFA50025DC5B18E4567BA03DAB72E9E2BB43B4807B1AC3762B2956E083C8A00896DC06040AD5B358F6ED602AA2824669EA5939A00D916F16DCA819A5F2828AA50DC6075AB3E76450054D5230FA7DC2FAA1AE123B706E76D77D7AC3ECB267BA9AE32DA3DF74C73D2803663B60B6CAC3A0AD7D39F75A01DC1AA906D6D3A403AAAF35268E4B5B313FDEC500696491451CD140183A7E3ED2AA7B9C006B9BD6CC90EA52A480E771E0D6F5BCA52456C720E6B666D1F4CD758CF74ED14C83B1FBD401C9E93331102E7856AE8A5240C8ACFB9D20E9D32BC4ADE46400C6B4C00F06EC76A00A4D36E38CF22A78D8961F4AABB08918F156A1195C9A007CB8DBC9AC9BA9F6F00FD2B42EA4089EF58570DC9E2802BCB3127AD5DD16E7C8B876FE2D840AA09034CFC0AD6B7B0F2D727AD003352D5A3846E95C927A00339AA169A8C774780CBE9BBBD47AC5B947525720F7A6DB797E5A8C01E98A00D609530912DD1A476C281924D5759015E4F6AAD7B209A229D47A5006A58EA914EE4C726707904629DA8481AE55971CAFCD54347D3C94F3170066AD5E5BC91C81BB5005CB77CAF15702E45655A372335A8992A48A0052368C83522CB818AAACCCAC4F63423927A74A00354B8D966C075618AE663630C9C8C679E7D2B675106678E21D339358DAAC81AED56219088178A00DAD36E37ACA9D4143FCAB43450C2CB91D4E6B3746B2912032C9C330C015D15BC62285500E9400EE71453B34500727673A5C461D338E8411D2BA0822FB469ED20E190638EF5CC6951BA432EE520F987A8ED5A316A9716923422D6468DBFE5A01F2E680249E5BC780472E7CA520F26A6DFFB9014F6ACDBABE9A5E390BE98AB36D2874C673C50026DFDE000D5A56DAB506D05C63B54E1576E280295D0DD9CD544B432373F76B4268CB1E3BD35DD6DE3E7F4A0048A18ADD37605453DF228EB8AA72DE6EE067DF154E4CC8D934005E5C79C304E6B343957C03569E1F9B8AA73C4E092BD6802E7DAD963E0F3490B973963D4F359B899980C1AD4B6B76D993401D2E9B2A450AA6456A3C493C78233C573902BA8CF4ABF05DB29C16A0056B66824C0E95720276E33DA9FB96E1011D71488841E9400C9460734429DCD4B22E7AF4A44F951B2680293DB4D793CA21EA060735A76765656F66FE6C1119D47071CD53D398B6EDAFB5C9AD982CD0C6ED31F9BA8E6802A5BA1D9B9BBF4F6AB1F4A8CDC42BC6F147DA21FEF50049D68A8BED317F7BF4A2803941A9BF6DB4EFED273C616B2444E075A5113FF0078D006AFF6811C6D539A9AD788C483F8B358BE537F7AAFD9CC5623112783401AAAC7A8A9E23B8567249B5093CF34F5BA2005A00B6CEAB924D62DFDD1DE7918AB524C76F3F9D63DD032311EB4015DAF6343CB8EBCD324D56355F535326971CBF7C7E353FF00675BC647EED5BEB40195FDA6A7AE4548B7F137561F8D49776F016C2C6AA3D0566C966ADD38A00D517308EE2A65BD5CF0C31F5AC2169C8E4D69D969D0BB012B103DA8035ADF50438526AE798BF781ACDFEC7848FDDBB063D307A5462DEF2DD8EE6CAD0074BA749F3F5E0F6AD361839AE76C652A54D6F093E4CD00123557B990245F5A4792A8DE48CCA1477A006473794D95622AE7F6BCA17EF66B1BCA7FEF52F94DFDE3401AC75393B9147F69BF1C8AC9F298F7A5F28FF78D006AFF0069BF52451595E5367EF51400A6D8E3A53BECDC74AD5F27DA90C1CD0065FD98D46D1BC0FBF1F2F735B5E4FB54375066DE4C0E71C500641B8C9EBD3D6A7521941CF6ACF71B5949E6A5825DDC7419A00B44123AD56DBC9A9259464807902AA8908CF3401637055EB4DDD9EF5097A63CC16801EF0C6CC493519B7873C9E6AACD74D9F9455479A63922803516CE327861F855A8ADC2B704561C53CE879E6B4ADA727AE45006D43F28E2A49887502A9C721E39A9F703824D003A08B0FF008D5F698A25528E4EB8A7C926531400A26C83CF534C5432C848E82A388176DABD7B0AD8B6B5D91004727AD0067FD98D02DAB5BC8F6A5F207A50064FD948A3ECC476AD6F27DA810FB500657D98D15ABE4FB51401AE34FB7CF29D3DE9469D6FFDCFD6AD0A7500541A75BFF73F5A8AEB4FB75B77609FC27BD68D3664DF130F51401E717D60CB6E2400920722B0D2E489703A0AEEAEE20BB97D335CAEA9A702ED2C202B7700714011ABA98B3DFD698483C015412E248DF6C8B8C7AD5849F2DFD73401691371C7E7563ECB19233D71D2A90B808B52FDA723AFCC68020B8817710B55C458E2AD364AE7351EDEE680123886791DEB56D6CD1873C5505500F15A10CFB5464F4A00B0F6A235E3B5577383C54D25CE46322A06719EDC500499C1054F6A6B4F97DB55A5B95C617B55DD3AD0DC38771C638A00DDF0CD825C4CD24C32ABC818EB5D77F67DBF4F2C557D16D960B15C28E6B531C50054FECFB7CE3CB14BF60B7FF9E62ADE28C50054FB05BFFCF3141B0B7ED18AB78E293140150D8DBFFCF31455B228A00CF140A28A0064B3242B963F419ACDB8D6E38A4F2C2E58F6A28A00CDBB70FB9BD79AC3B83B8E28A28031AEED564CF1D6B2A48A581B8CD145001F6A18C1A7C337CDD7228A2802D79DC63342CB95E7A668A2801DE760F078F4A71B9C2F5A28A0068B93B739A4F36491B6A0249F4A28A00D0B3B0C7EF273963D057436402741C628A28037AC75A0B70B6CDC0232A6B57EDEA7F8A8A280227D4B6C980D522DF92C3A73451401616ED48C1A77DA937628A2801DE747EA28A28A00FFD9";
            byte[] byteArray = new byte[(varbinaryValue.Length - 2) / 2];
            for (int i = 0; i < byteArray.Length; i++)
            {
                byteArray[i] = Convert.ToByte(varbinaryValue.Substring(i * 2 + 2, 2), 16);
            }
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000"),
                Lice = byteArray,
                Lice2 = byteArray,
                Lice3 = byteArray,
                Lice4 = byteArray,
                Lice5 = byteArray,
            };
            Korisnik korisnik2 = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "asaaa",
                Lozinka = "dsfdssdfdfs",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2020-08-03 00:00:00.000"),
                Lice = byteArray,
                Lice2 = byteArray,
                Lice3 = byteArray,
                Lice4 = byteArray,
                Lice5 = byteArray
            };

            var popisKorisnika = new List<Korisnik>();
            popisKorisnika.Add(korisnik);
            popisKorisnika.Add(korisnik2);

            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Image<Gray, Byte>> slike = korisnikServis.popuniPopisSlika(popisKorisnika);

            Assert.Equal(10, slike.Count);
        }

        [Fact]
        public void popuniPopisSlika_GivenEmptyUsersList_ReturnsEmptyList()
        {
            var popisKorisnika = new List<Korisnik>();
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Image<Gray, Byte>> slike = korisnikServis.popuniPopisSlika(popisKorisnika);

            Assert.True(slike.Count == 0);
        }

        [Fact]
        public void popuniPopisSlika_GivenUsersWithoutImage_ReturnsEmptyList()
        {
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000")
            };
            Korisnik korisnik2 = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "asaaa",
                Lozinka = "dsfdssdfdfs",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2020-08-03 00:00:00.000")
            };

            var popisKorisnika = new List<Korisnik>();
            popisKorisnika.Add(korisnik);
            popisKorisnika.Add(korisnik2);

            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Image<Gray, Byte>> slike = korisnikServis.popuniPopisSlika(popisKorisnika);

            Assert.True(slike.Count==0);

        }
        [Fact]
        public void popuniPopisKorisnikaSaSlikama_GivenUsersList_ReturnsListOfUsers()
        {
            string varbinaryValue = "0xFFD8FFE000104A46494600010101006000600000FFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC000110800C800C803012200021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00F47F29339DDF29E6A278E21C0279EE6A48C6F3B71F4A8091F6AF218F7C1A00A5770001810A40E86B97D4BCBCED0C0B679C5745AF38B488C65FDB35C59677999987CB9EB40156657270071EB508B756FBC49F6AD26DA47F4A238373702802945A7ACCF855AD48345F2D77EDE715B1A7D8858C6E1FA55F9633B70A3AD0072735B1048C74EB55DA2C0C015BD750EC90F7CD6749181D680326E22063C8EB59A53E6C77ADE95148C0ACCB987072050036DE523E53F855E95CFD991C74DD835938231EB9AD68713D998D8F5FD0D005275C72BD3BD2891D4E55CAB0FBAC29A3219A36EA3834F31ED1CFE06803774EF1212820BD40C98C17CF22B55E25961DAB379D6EC38CF38AE2997E607D6A7B3D425B597CA676D84E460E280361EC64B39F2013113F787415A30B65432394993A63BD3209DAFA0FF47915D80E509C6E14E589678C94CA4C9D8F51ED401AB61AE6D6D9326DF5DB5A7F6C8251F2BF5EC6B8D91D83EE030E3EF0F5AB51CE268F23861401D1ADCAC728527E53D0FA55DAE4A0BD25B6B9C83FA1AE9AD25F36DD5BAF14013F5A297B5140104B3385658CFCEBC8AAD7174240B36E1B94723D4553D55CC13C72E4ED248201C66B166D44A4A62DE1D33919EA2800D76F4DC36EDF8C8E73DEB9F13B16FBDF2F6ABDAA90D1824800F2083D6B260F99F1D68034EDC34AE1477EF5D059D98E38E9EB59FA3DA99240D8E3B575904223EA381400914185C63A54C20F94B11C7AD4C839E94E921F317693F2FA50073F7815FEEF3E86B2E58720E475AEA26B48D3B74AC9B955F98628039D9936E6B3A6C9E0F7ADBB98C7359EF06EFA500643260D4D14FE5A11EF53C96E3A8155A4888068026BA40EAB3C7D48E47AD4292865C139F4A742E443E593DF22A2923E7728C1CE68027D8248CE3A8E98A8DE0F363C7F1AF4A75B4849C8E08EA2A752AC4E3834014E0B996D9F7A92194FCC01AE9ED75486FD55D9B64E3F8D7827D88EF5CF4F1873BC75EF552166B56720F7E2803B5B8B759C192375320EBB4F5ACB676B7977FDDFEF0A8ACB50F323576E1C704FAD4D3B0989EDBA801E261E76E53C38AEB34197CCB5653FC26B8685F9DB9CE0D76BE1A19B690FA91401B78A29FB78A28032B5DB25B8D3A47E77C4A5D71ED5E75E7F99719E8075E6BD56EC2B5ACC1BA1420FE55E35732B40E5571807F3A00B33B7EF58090B293C82781572C1109000E4F53582B33CB265B807AD6EE94DBE55C76A00ECB4A802C608AD94538ACED394EC515BF0C41532C00CFAD00575F947350CD73B5480453AEEE238C1C30AC1BCBE40080D40125D5EBE719CFE359B25C93F7AA092E831EB54669F9E0D004B34F96355CC9EB5017FCE9A58F7A0091DF70C2D576048E99A93B668C7A50057F2B3CD1E493D6AD04029C17268033FECEC1F720EF4EF9BB0E7BD5F117A50F0E5738E68033BCE03208E6A3980DBC0E0D599E03DC0FA8AAAC840228022B7678D4824D68DBCC5E1009C91EB59392B9209ABB6EF84C9FCA80268E63F6C29FC22BD07C2F206B69547620D79C0C34BB81E7AD77DE1105A167073C007EB401D5638A28C7145004372BBA0947AA1FE55E17752E6E9949E84D7BD3AEE4C1EF5E0DA9C5E4DFDCC78E92B0FD68022F3016C0CE2B7B433BA7503D6B992FCFA574DE1A52D286C74EB401E8F68EB6D6E1DF83D8566EA3E25218A2B7E00D66EA5AA30FDD29EDCFB573922191892E79A00BB7BAFC85CFEF2B224D65D9B2CE71492C309FBCD9AA525BC45B826802F47AA166EBC558FB5891722B185BAAB02AD9F519AB51211D7F4A00D157CD3F3C641AAC84807353A007AD003C36474A7834C039C74A93690322801F9C73DA955D7B91552477008159F3DCC887AD006E19D1475151FDA50F7AE79EE9D8724D3A3989E39A00E8498DD7AF5A6BDB7C9F2D66C3232F24E6B6ED2E03AAAB28C50073B7319858E4700F4A87CD60C0D6B6B51A44E1BF84F7ACA1192DC0A00B714664E87AD7A5F84AD05BE981C1C973935E6D6A0F9AA2BD63401FF0012C8B8ED401A7839A29D8A280187A67D2BC3FC430B0D5EF1802374AC40FC6BD89750836FCCFCD799F8DD634D61DE0198E450C71D8F43401C94713135DDF862C82D8991BA93C66B93B68790C7A57A16910795A4C5DB23340183A97CB72FE84D63CD2B336C4EB5B7AB21DEC45627CE99D88493DE802192111A92F2553778F181266B5BEC425B7639DD215E335CD5C5BC919E878EA2802D107AA367E953DBDC32B6D63F9D55B65C9CF6039A7161E663AF3D68037A19038AB90C7BFA0AC8B20DD2BA5B2114509694F3D863AD0041F6639CF4A98C384CE2AEA2ACABBD4706A66B62D0B6076A00E6EE5E38C126B0EE6E03B10AA2AF6A4584CCA7802A86C1B4B81D2802240CDD6AE40190F0A3F2ACE6B8649001D4D69E9CF34ACE00DC40C9CD005E81D4B00E9835A30C409CAD52F9268F85DB22F6AB764C5800DC50051D7D192DC16F5C8AC7B498F4CD74BE268BFE25B1B63A1C1AE56CF25F1401B9000D3C781EF5EB1A34463D3E256EE322BCAF4D5F32F631DBA57AB5BDE5BC7046833F2A81D2802FE28AABFDA10FBD1401E53637F7979790C0B72C1A460B927815D07893C30B0E99F6B8EF4DC4A832C028C11ED5C67879DDF5BB503FBC4FE95D67DBE758A642774633C7A5007216C0CB2A22E719AF4D820DBA7C283B20AE1B4FB657BC509D0B57A2C6A02AA7A0C500615CE97E7724550B9D3E2B78F85E71C9AEC8C036D51B8D352E0618E3E9401E7937C849562B59375089242CC793D6BBEBDF0F5B2E4EE7CFFBDC561DCE990AB6157E9401CAF97B461054D6F66CEDF77AD6FC7A6AE791D2AEDBD92A9181401574ED3B91915D45B69914C1448BF28E98A8EC605561C57456908D80E28029496114312AA2600151343881B1E95AB798C62AAB2836FD3F1A00E075EB12252E0704573CAA41656E86BD0EF6D84AA548AE66EB482AFF0020E28039F5B53E67DD0C074AE8AC45BDBC390332BFDEFF000AAD1D8C8ADC0CFB568456B22F2633F5C50040F6CCEFBD063D2AED95BB6F19ABF696F9C657B7A5684767B5B38A00C7F1143BB46638FBA457176ABB5C9AF46D6E1CE8F38FF67FAD7051C7B1980F5A00DDD02DFCEBF524700E4D76BE4438FF00562B17C2D345A64325C48A0B380141AE80CE2EC79A11537761401179308E762D1526DA2803CF740B5103CF7A400B1A10A7DCD6D3404787E49FF8A43919F4AAB05932D9B4311259DC55BD72F9515AD23E238D020028033B4200DEC6BEF9AEE226E735C4E8B1BADC452918562403EB5D609085A00D1370318E2A94F78470B55249CE707AD4449618F5A006DCCCD20C13548C191B8F19AD108ABC919AAB72DC7068029B00BD29D1F032DCFD2A09A7C1E452D987BCB948A3E4B1FCA8037B4D85E761B47CBDCD75505B055158E2E20D321112E3E51C9AAF37888AA908DF36280346F593CC2991D69CB007B6F94D71F2EA72348496AD6D335765C239CAFA50025DC5B18E4567BA03DAB72E9E2BB43B4807B1AC3762B2956E083C8A00896DC06040AD5B358F6ED602AA2824669EA5939A00D916F16DCA819A5F2828AA50DC6075AB3E76450054D5230FA7DC2FAA1AE123B706E76D77D7AC3ECB267BA9AE32DA3DF74C73D2803663B60B6CAC3A0AD7D39F75A01DC1AA906D6D3A403AAAF35268E4B5B313FDEC500696491451CD140183A7E3ED2AA7B9C006B9BD6CC90EA52A480E771E0D6F5BCA52456C720E6B666D1F4CD758CF74ED14C83B1FBD401C9E93331102E7856AE8A5240C8ACFB9D20E9D32BC4ADE46400C6B4C00F06EC76A00A4D36E38CF22A78D8961F4AABB08918F156A1195C9A007CB8DBC9AC9BA9F6F00FD2B42EA4089EF58570DC9E2802BCB3127AD5DD16E7C8B876FE2D840AA09034CFC0AD6B7B0F2D727AD003352D5A3846E95C927A00339AA169A8C774780CBE9BBBD47AC5B947525720F7A6DB797E5A8C01E98A00D609530912DD1A476C281924D5759015E4F6AAD7B209A229D47A5006A58EA914EE4C726707904629DA8481AE55971CAFCD54347D3C94F3170066AD5E5BC91C81BB5005CB77CAF15702E45655A372335A8992A48A0052368C83522CB818AAACCCAC4F63423927A74A00354B8D966C075618AE663630C9C8C679E7D2B675106678E21D339358DAAC81AED56219088178A00DAD36E37ACA9D4143FCAB43450C2CB91D4E6B3746B2912032C9C330C015D15BC62285500E9400EE71453B34500727673A5C461D338E8411D2BA0822FB469ED20E190638EF5CC6951BA432EE520F987A8ED5A316A9716923422D6468DBFE5A01F2E680249E5BC780472E7CA520F26A6DFFB9014F6ACDBABE9A5E390BE98AB36D2874C673C50026DFDE000D5A56DAB506D05C63B54E1576E280295D0DD9CD544B432373F76B4268CB1E3BD35DD6DE3E7F4A0048A18ADD37605453DF228EB8AA72DE6EE067DF154E4CC8D934005E5C79C304E6B343957C03569E1F9B8AA73C4E092BD6802E7DAD963E0F3490B973963D4F359B899980C1AD4B6B76D993401D2E9B2A450AA6456A3C493C78233C573902BA8CF4ABF05DB29C16A0056B66824C0E95720276E33DA9FB96E1011D71488841E9400C9460734429DCD4B22E7AF4A44F951B2680293DB4D793CA21EA060735A76765656F66FE6C1119D47071CD53D398B6EDAFB5C9AD982CD0C6ED31F9BA8E6802A5BA1D9B9BBF4F6AB1F4A8CDC42BC6F147DA21FEF50049D68A8BED317F7BF4A2803941A9BF6DB4EFED273C616B2444E075A5113FF0078D006AFF6811C6D539A9AD788C483F8B358BE537F7AAFD9CC5623112783401AAAC7A8A9E23B8567249B5093CF34F5BA2005A00B6CEAB924D62DFDD1DE7918AB524C76F3F9D63DD032311EB4015DAF6343CB8EBCD324D56355F535326971CBF7C7E353FF00675BC647EED5BEB40195FDA6A7AE4548B7F137561F8D49776F016C2C6AA3D0566C966ADD38A00D517308EE2A65BD5CF0C31F5AC2169C8E4D69D969D0BB012B103DA8035ADF50438526AE798BF781ACDFEC7848FDDBB063D307A5462DEF2DD8EE6CAD0074BA749F3F5E0F6AD361839AE76C652A54D6F093E4CD00123557B990245F5A4792A8DE48CCA1477A006473794D95622AE7F6BCA17EF66B1BCA7FEF52F94DFDE3401AC75393B9147F69BF1C8AC9F298F7A5F28FF78D006AFF0069BF52451595E5367EF51400A6D8E3A53BECDC74AD5F27DA90C1CD0065FD98D46D1BC0FBF1F2F735B5E4FB54375066DE4C0E71C500641B8C9EBD3D6A7521941CF6ACF71B5949E6A5825DDC7419A00B44123AD56DBC9A9259464807902AA8908CF3401637055EB4DDD9EF5097A63CC16801EF0C6CC493519B7873C9E6AACD74D9F9455479A63922803516CE327861F855A8ADC2B704561C53CE879E6B4ADA727AE45006D43F28E2A49887502A9C721E39A9F703824D003A08B0FF008D5F698A25528E4EB8A7C926531400A26C83CF534C5432C848E82A388176DABD7B0AD8B6B5D91004727AD0067FD98D02DAB5BC8F6A5F207A50064FD948A3ECC476AD6F27DA810FB500657D98D15ABE4FB51401AE34FB7CF29D3DE9469D6FFDCFD6AD0A7500541A75BFF73F5A8AEB4FB75B77609FC27BD68D3664DF130F51401E717D60CB6E2400920722B0D2E489703A0AEEAEE20BB97D335CAEA9A702ED2C202B7700714011ABA98B3DFD698483C015412E248DF6C8B8C7AD5849F2DFD73401691371C7E7563ECB19233D71D2A90B808B52FDA723AFCC68020B8817710B55C458E2AD364AE7351EDEE680123886791DEB56D6CD1873C5505500F15A10CFB5464F4A00B0F6A235E3B5577383C54D25CE46322A06719EDC500499C1054F6A6B4F97DB55A5B95C617B55DD3AD0DC38771C638A00DDF0CD825C4CD24C32ABC818EB5D77F67DBF4F2C557D16D960B15C28E6B531C50054FECFB7CE3CB14BF60B7FF9E62ADE28C50054FB05BFFCF3141B0B7ED18AB78E293140150D8DBFFCF31455B228A00CF140A28A0064B3242B963F419ACDB8D6E38A4F2C2E58F6A28A00CDBB70FB9BD79AC3B83B8E28A28031AEED564CF1D6B2A48A581B8CD145001F6A18C1A7C337CDD7228A2802D79DC63342CB95E7A668A2801DE760F078F4A71B9C2F5A28A0068B93B739A4F36491B6A0249F4A28A00D0B3B0C7EF273963D057436402741C628A28037AC75A0B70B6CDC0232A6B57EDEA7F8A8A280227D4B6C980D522DF92C3A73451401616ED48C1A77DA937628A2801DE747EA28A28A00FFD9";
            byte[] byteArray = new byte[(varbinaryValue.Length - 2) / 2];
            for (int i = 0; i < byteArray.Length; i++)
            {
                byteArray[i] = Convert.ToByte(varbinaryValue.Substring(i * 2 + 2, 2), 16);
            }
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000"),
                Lice = byteArray,
                Lice2 = byteArray,
                Lice3 = byteArray,
                Lice4 = byteArray,
                Lice5 = byteArray,
            };
            Korisnik korisnik2 = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "asaaa",
                Lozinka = "dsfdssdfdfs",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2020-08-03 00:00:00.000"),
                Lice = byteArray,
                Lice2 = byteArray,
                Lice3 = byteArray,
                Lice4 = byteArray,
                Lice5 = byteArray
            };

            var popisKorisnika = new List<Korisnik>();
            popisKorisnika.Add(korisnik);
            popisKorisnika.Add(korisnik2);

            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Korisnik> korisnici = korisnikServis.popuniPopisKorisnikaSaSlikama(popisKorisnika);

            Assert.Equal(2, korisnici.Count());
        }

        [Fact]
        public void popuniPopisKorisnikaSaSlikama_GivenEmptyUsersList_ReturnsEmptyListOfUsers()
        {

            var popisKorisnika = new List<Korisnik>();
            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Korisnik> korisnici = korisnikServis.popuniPopisKorisnikaSaSlikama(popisKorisnika);

            Assert.Equal(0, korisnici.Count());
        }

        [Fact]
        public void popuniPopisKorisnikaSaSlikama_GivenUsersListWithoutImage_ReturnsEmptyListOfUsers()
        {
            string varbinaryValue = "0xFFD8FFE000104A46494600010101006000600000FFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC000110800C800C803012200021101031101FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDA000C03010002110311003F00F47F29339DDF29E6A278E21C0279EE6A48C6F3B71F4A8091F6AF218F7C1A00A5770001810A40E86B97D4BCBCED0C0B679C5745AF38B488C65FDB35C59677999987CB9EB40156657270071EB508B756FBC49F6AD26DA47F4A238373702802945A7ACCF855AD48345F2D77EDE715B1A7D8858C6E1FA55F9633B70A3AD0072735B1048C74EB55DA2C0C015BD750EC90F7CD6749181D680326E22063C8EB59A53E6C77ADE95148C0ACCB987072050036DE523E53F855E95CFD991C74DD835938231EB9AD68713D998D8F5FD0D005275C72BD3BD2891D4E55CAB0FBAC29A3219A36EA3834F31ED1CFE06803774EF1212820BD40C98C17CF22B55E25961DAB379D6EC38CF38AE2997E607D6A7B3D425B597CA676D84E460E280361EC64B39F2013113F787415A30B65432394993A63BD3209DAFA0FF47915D80E509C6E14E589678C94CA4C9D8F51ED401AB61AE6D6D9326DF5DB5A7F6C8251F2BF5EC6B8D91D83EE030E3EF0F5AB51CE268F23861401D1ADCAC728527E53D0FA55DAE4A0BD25B6B9C83FA1AE9AD25F36DD5BAF14013F5A297B5140104B3385658CFCEBC8AAD7174240B36E1B94723D4553D55CC13C72E4ED248201C66B166D44A4A62DE1D33919EA2800D76F4DC36EDF8C8E73DEB9F13B16FBDF2F6ABDAA90D1824800F2083D6B260F99F1D68034EDC34AE1477EF5D059D98E38E9EB59FA3DA99240D8E3B575904223EA381400914185C63A54C20F94B11C7AD4C839E94E921F317693F2FA50073F7815FEEF3E86B2E58720E475AEA26B48D3B74AC9B955F98628039D9936E6B3A6C9E0F7ADBB98C7359EF06EFA500643260D4D14FE5A11EF53C96E3A8155A4888068026BA40EAB3C7D48E47AD4292865C139F4A742E443E593DF22A2923E7728C1CE68027D8248CE3A8E98A8DE0F363C7F1AF4A75B4849C8E08EA2A752AC4E3834014E0B996D9F7A92194FCC01AE9ED75486FD55D9B64E3F8D7827D88EF5CF4F1873BC75EF552166B56720F7E2803B5B8B759C192375320EBB4F5ACB676B7977FDDFEF0A8ACB50F323576E1C704FAD4D3B0989EDBA801E261E76E53C38AEB34197CCB5653FC26B8685F9DB9CE0D76BE1A19B690FA91401B78A29FB78A28032B5DB25B8D3A47E77C4A5D71ED5E75E7F99719E8075E6BD56EC2B5ACC1BA1420FE55E35732B40E5571807F3A00B33B7EF58090B293C82781572C1109000E4F53582B33CB265B807AD6EE94DBE55C76A00ECB4A802C608AD94538ACED394EC515BF0C41532C00CFAD00575F947350CD73B5480453AEEE238C1C30AC1BCBE40080D40125D5EBE719CFE359B25C93F7AA092E831EB54669F9E0D004B34F96355CC9EB5017FCE9A58F7A0091DF70C2D576048E99A93B668C7A50057F2B3CD1E493D6AD04029C17268033FECEC1F720EF4EF9BB0E7BD5F117A50F0E5738E68033BCE03208E6A3980DBC0E0D599E03DC0FA8AAAC840228022B7678D4824D68DBCC5E1009C91EB59392B9209ABB6EF84C9FCA80268E63F6C29FC22BD07C2F206B69547620D79C0C34BB81E7AD77DE1105A167073C007EB401D5638A28C7145004372BBA0947AA1FE55E17752E6E9949E84D7BD3AEE4C1EF5E0DA9C5E4DFDCC78E92B0FD68022F3016C0CE2B7B433BA7503D6B992FCFA574DE1A52D286C74EB401E8F68EB6D6E1DF83D8566EA3E25218A2B7E00D66EA5AA30FDD29EDCFB573922191892E79A00BB7BAFC85CFEF2B224D65D9B2CE71492C309FBCD9AA525BC45B826802F47AA166EBC558FB5891722B185BAAB02AD9F519AB51211D7F4A00D157CD3F3C641AAC84807353A007AD003C36474A7834C039C74A93690322801F9C73DA955D7B91552477008159F3DCC887AD006E19D1475151FDA50F7AE79EE9D8724D3A3989E39A00E8498DD7AF5A6BDB7C9F2D66C3232F24E6B6ED2E03AAAB28C50073B7319858E4700F4A87CD60C0D6B6B51A44E1BF84F7ACA1192DC0A00B714664E87AD7A5F84AD05BE981C1C973935E6D6A0F9AA2BD63401FF0012C8B8ED401A7839A29D8A280187A67D2BC3FC430B0D5EF1802374AC40FC6BD89750836FCCFCD799F8DD634D61DE0198E450C71D8F43401C94713135DDF862C82D8991BA93C66B93B68790C7A57A16910795A4C5DB23340183A97CB72FE84D63CD2B336C4EB5B7AB21DEC45627CE99D88493DE802192111A92F2553778F181266B5BEC425B7639DD215E335CD5C5BC919E878EA2802D107AA367E953DBDC32B6D63F9D55B65C9CF6039A7161E663AF3D68037A19038AB90C7BFA0AC8B20DD2BA5B2114509694F3D863AD0041F6639CF4A98C384CE2AEA2ACABBD4706A66B62D0B6076A00E6EE5E38C126B0EE6E03B10AA2AF6A4584CCA7802A86C1B4B81D2802240CDD6AE40190F0A3F2ACE6B8649001D4D69E9CF34ACE00DC40C9CD005E81D4B00E9835A30C409CAD52F9268F85DB22F6AB764C5800DC50051D7D192DC16F5C8AC7B498F4CD74BE268BFE25B1B63A1C1AE56CF25F1401B9000D3C781EF5EB1A34463D3E256EE322BCAF4D5F32F631DBA57AB5BDE5BC7046833F2A81D2802FE28AABFDA10FBD1401E53637F7979790C0B72C1A460B927815D07893C30B0E99F6B8EF4DC4A832C028C11ED5C67879DDF5BB503FBC4FE95D67DBE758A642774633C7A5007216C0CB2A22E719AF4D820DBA7C283B20AE1B4FB657BC509D0B57A2C6A02AA7A0C500615CE97E7724550B9D3E2B78F85E71C9AEC8C036D51B8D352E0618E3E9401E7937C849562B59375089242CC793D6BBEBDF0F5B2E4EE7CFFBDC561DCE990AB6157E9401CAF97B461054D6F66CEDF77AD6FC7A6AE791D2AEDBD92A9181401574ED3B91915D45B69914C1448BF28E98A8EC605561C57456908D80E28029496114312AA2600151343881B1E95AB798C62AAB2836FD3F1A00E075EB12252E0704573CAA41656E86BD0EF6D84AA548AE66EB482AFF0020E28039F5B53E67DD0C074AE8AC45BDBC390332BFDEFF000AAD1D8C8ADC0CFB568456B22F2633F5C50040F6CCEFBD063D2AED95BB6F19ABF696F9C657B7A5684767B5B38A00C7F1143BB46638FBA457176ABB5C9AF46D6E1CE8F38FF67FAD7051C7B1980F5A00DDD02DFCEBF524700E4D76BE4438FF00562B17C2D345A64325C48A0B380141AE80CE2EC79A11537761401179308E762D1526DA2803CF740B5103CF7A400B1A10A7DCD6D3404787E49FF8A43919F4AAB05932D9B4311259DC55BD72F9515AD23E238D020028033B4200DEC6BEF9AEE226E735C4E8B1BADC452918562403EB5D609085A00D1370318E2A94F78470B55249CE707AD4449618F5A006DCCCD20C13548C191B8F19AD108ABC919AAB72DC7068029B00BD29D1F032DCFD2A09A7C1E452D987BCB948A3E4B1FCA8037B4D85E761B47CBDCD75505B055158E2E20D321112E3E51C9AAF37888AA908DF36280346F593CC2991D69CB007B6F94D71F2EA72348496AD6D335765C239CAFA50025DC5B18E4567BA03DAB72E9E2BB43B4807B1AC3762B2956E083C8A00896DC06040AD5B358F6ED602AA2824669EA5939A00D916F16DCA819A5F2828AA50DC6075AB3E76450054D5230FA7DC2FAA1AE123B706E76D77D7AC3ECB267BA9AE32DA3DF74C73D2803663B60B6CAC3A0AD7D39F75A01DC1AA906D6D3A403AAAF35268E4B5B313FDEC500696491451CD140183A7E3ED2AA7B9C006B9BD6CC90EA52A480E771E0D6F5BCA52456C720E6B666D1F4CD758CF74ED14C83B1FBD401C9E93331102E7856AE8A5240C8ACFB9D20E9D32BC4ADE46400C6B4C00F06EC76A00A4D36E38CF22A78D8961F4AABB08918F156A1195C9A007CB8DBC9AC9BA9F6F00FD2B42EA4089EF58570DC9E2802BCB3127AD5DD16E7C8B876FE2D840AA09034CFC0AD6B7B0F2D727AD003352D5A3846E95C927A00339AA169A8C774780CBE9BBBD47AC5B947525720F7A6DB797E5A8C01E98A00D609530912DD1A476C281924D5759015E4F6AAD7B209A229D47A5006A58EA914EE4C726707904629DA8481AE55971CAFCD54347D3C94F3170066AD5E5BC91C81BB5005CB77CAF15702E45655A372335A8992A48A0052368C83522CB818AAACCCAC4F63423927A74A00354B8D966C075618AE663630C9C8C679E7D2B675106678E21D339358DAAC81AED56219088178A00DAD36E37ACA9D4143FCAB43450C2CB91D4E6B3746B2912032C9C330C015D15BC62285500E9400EE71453B34500727673A5C461D338E8411D2BA0822FB469ED20E190638EF5CC6951BA432EE520F987A8ED5A316A9716923422D6468DBFE5A01F2E680249E5BC780472E7CA520F26A6DFFB9014F6ACDBABE9A5E390BE98AB36D2874C673C50026DFDE000D5A56DAB506D05C63B54E1576E280295D0DD9CD544B432373F76B4268CB1E3BD35DD6DE3E7F4A0048A18ADD37605453DF228EB8AA72DE6EE067DF154E4CC8D934005E5C79C304E6B343957C03569E1F9B8AA73C4E092BD6802E7DAD963E0F3490B973963D4F359B899980C1AD4B6B76D993401D2E9B2A450AA6456A3C493C78233C573902BA8CF4ABF05DB29C16A0056B66824C0E95720276E33DA9FB96E1011D71488841E9400C9460734429DCD4B22E7AF4A44F951B2680293DB4D793CA21EA060735A76765656F66FE6C1119D47071CD53D398B6EDAFB5C9AD982CD0C6ED31F9BA8E6802A5BA1D9B9BBF4F6AB1F4A8CDC42BC6F147DA21FEF50049D68A8BED317F7BF4A2803941A9BF6DB4EFED273C616B2444E075A5113FF0078D006AFF6811C6D539A9AD788C483F8B358BE537F7AAFD9CC5623112783401AAAC7A8A9E23B8567249B5093CF34F5BA2005A00B6CEAB924D62DFDD1DE7918AB524C76F3F9D63DD032311EB4015DAF6343CB8EBCD324D56355F535326971CBF7C7E353FF00675BC647EED5BEB40195FDA6A7AE4548B7F137561F8D49776F016C2C6AA3D0566C966ADD38A00D517308EE2A65BD5CF0C31F5AC2169C8E4D69D969D0BB012B103DA8035ADF50438526AE798BF781ACDFEC7848FDDBB063D307A5462DEF2DD8EE6CAD0074BA749F3F5E0F6AD361839AE76C652A54D6F093E4CD00123557B990245F5A4792A8DE48CCA1477A006473794D95622AE7F6BCA17EF66B1BCA7FEF52F94DFDE3401AC75393B9147F69BF1C8AC9F298F7A5F28FF78D006AFF0069BF52451595E5367EF51400A6D8E3A53BECDC74AD5F27DA90C1CD0065FD98D46D1BC0FBF1F2F735B5E4FB54375066DE4C0E71C500641B8C9EBD3D6A7521941CF6ACF71B5949E6A5825DDC7419A00B44123AD56DBC9A9259464807902AA8908CF3401637055EB4DDD9EF5097A63CC16801EF0C6CC493519B7873C9E6AACD74D9F9455479A63922803516CE327861F855A8ADC2B704561C53CE879E6B4ADA727AE45006D43F28E2A49887502A9C721E39A9F703824D003A08B0FF008D5F698A25528E4EB8A7C926531400A26C83CF534C5432C848E82A388176DABD7B0AD8B6B5D91004727AD0067FD98D02DAB5BC8F6A5F207A50064FD948A3ECC476AD6F27DA810FB500657D98D15ABE4FB51401AE34FB7CF29D3DE9469D6FFDCFD6AD0A7500541A75BFF73F5A8AEB4FB75B77609FC27BD68D3664DF130F51401E717D60CB6E2400920722B0D2E489703A0AEEAEE20BB97D335CAEA9A702ED2C202B7700714011ABA98B3DFD698483C015412E248DF6C8B8C7AD5849F2DFD73401691371C7E7563ECB19233D71D2A90B808B52FDA723AFCC68020B8817710B55C458E2AD364AE7351EDEE680123886791DEB56D6CD1873C5505500F15A10CFB5464F4A00B0F6A235E3B5577383C54D25CE46322A06719EDC500499C1054F6A6B4F97DB55A5B95C617B55DD3AD0DC38771C638A00DDF0CD825C4CD24C32ABC818EB5D77F67DBF4F2C557D16D960B15C28E6B531C50054FECFB7CE3CB14BF60B7FF9E62ADE28C50054FB05BFFCF3141B0B7ED18AB78E293140150D8DBFFCF31455B228A00CF140A28A0064B3242B963F419ACDB8D6E38A4F2C2E58F6A28A00CDBB70FB9BD79AC3B83B8E28A28031AEED564CF1D6B2A48A581B8CD145001F6A18C1A7C337CDD7228A2802D79DC63342CB95E7A668A2801DE760F078F4A71B9C2F5A28A0068B93B739A4F36491B6A0249F4A28A00D0B3B0C7EF273963D057436402741C628A28037AC75A0B70B6CDC0232A6B57EDEA7F8A8A280227D4B6C980D522DF92C3A73451401616ED48C1A77DA937628A2801DE747EA28A28A00FFD9";
            byte[] byteArray = new byte[(varbinaryValue.Length - 2) / 2];
            for (int i = 0; i < byteArray.Length; i++)
            {
                byteArray[i] = Convert.ToByte(varbinaryValue.Substring(i * 2 + 2, 2), 16);
            }
            Korisnik korisnik = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "franjo",
                Lozinka = "franjolozinka",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2001-08-03 00:00:00.000"),
                Lice = byteArray,
                Lice2 = byteArray,
                Lice3 = byteArray,
                Lice4 = byteArray,
                Lice5 = byteArray,
            };
            Korisnik korisnik2 = new Korisnik
            {
                ID = 12345,
                Korisnicko_ime = "asaaa",
                Lozinka = "dsfdssdfdfs",
                ID_tip_korisnika = 0,
                Datum_rodenja = DateTime.Parse("2020-08-03 00:00:00.000")
            };

            var popisKorisnika = new List<Korisnik>();
            popisKorisnika.Add(korisnik);
            popisKorisnika.Add(korisnik2);

            var fakeRepo = A.Fake<IKorisnikRepozitorij>();
            KorisnikServis korisnikServis = new KorisnikServis(fakeRepo);
            List<Korisnik> korisnici = korisnikServis.popuniPopisKorisnikaSaSlikama(popisKorisnika);

            Assert.Equal(1, korisnici.Count());
        }

    }
}
